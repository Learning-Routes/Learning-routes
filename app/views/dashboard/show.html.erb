<% content_for(:title, t("dashboard.title")) %>

<%# === Header === %>
<div style="margin-bottom:2rem;">
  <h1 style="font-family:'DM Sans',sans-serif; font-weight:700; font-size:1.5rem; letter-spacing:-0.5px; color:#1C1812; margin:0 0 0.3rem;">
    <%= t("dashboard.greeting", name: current_user.name.to_s.split.first || current_user.name) %>
  </h1>
  <p style="font-family:'DM Sans',sans-serif; font-size:0.85rem; color:#A09889; margin:0;">
    <%= t("dashboard.subheading") %>
  </p>
</div>

<%# === Email verification banner === %>
<% if !current_user.email_verified? %>
  <div style="background:rgba(176,152,72,0.08); border:1px solid rgba(176,152,72,0.15); border-radius:12px; padding:0.75rem 1rem; margin-bottom:1.2rem; display:flex; align-items:center; gap:0.6rem;">
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
      <path d="M8 1.5l6 11H2l6-11z" stroke="#B09848" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M8 6v3M8 11h.01" stroke="#B09848" stroke-width="1.2" stroke-linecap="round"/>
    </svg>
    <p style="font-family:'DM Sans',sans-serif; font-size:0.78rem; color:#8B6D28; margin:0;">
      <%= t("dashboard.verify_email") %>
      <%= link_to t("dashboard.resend_verification"), core.resend_verification_path,
          data: { turbo_method: :post },
          style: "color:#8B6D28; font-weight:600; text-decoration:underline; text-underline-offset:2px;" %>
    </p>
  </div>
<% end %>

<% if @routes.any? %>
  <%# === Routes list === %>
  <div style="display:flex; flex-direction:column; gap:0.75rem;">
    <% @routes.each do |route| %>
      <%= link_to learning_routes_engine.route_path(route),
          class: "card-hover",
          style: "display:block; background:rgba(255,255,255,0.6); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border:1px solid rgba(28,24,18,0.06); border-radius:14px; padding:1.2rem 1.3rem; text-decoration:none;" do %>
        <div style="display:flex; align-items:center; justify-content:space-between; gap:1rem;">
          <div style="width:38px; height:38px; border-radius:11px; background:<%= route_accent_color(route) %>12; display:flex; align-items:center; justify-content:center; flex-shrink:0; font-size:1.15rem;">
            <%= topic_emoji_for(route.topic) %>
          </div>
          <div style="flex:1; min-width:0;">
            <h3 style="font-family:'DM Sans',sans-serif; font-weight:600; font-size:0.92rem; color:#1C1812; margin:0 0 0.3rem; letter-spacing:-0.2px;">
              <%= route.localized_topic %>
            </h3>
            <p style="font-family:'DM Sans',sans-serif; font-size:0.75rem; color:#A09889; margin:0;">
              <% if route.subject_area.present? %><%= route.localized_subject_area %> &middot; <% end %><%= t("dashboard.steps_progress", completed: route.route_steps.count(&:completed?), total: route.total_steps) %>
            </p>
          </div>
          <div style="display:flex; align-items:center; gap:1rem; flex-shrink:0;">
            <div style="text-align:right;">
              <span style="font-family:'DM Mono',monospace; font-size:0.82rem; font-weight:500; color:#1C1812;"><%= route.progress_percentage %>%</span>
              <div style="width:5rem; height:4px; background:rgba(28,24,18,0.06); border-radius:2px; margin-top:0.35rem;">
                <div style="width:<%= route.progress_percentage %>%; height:100%; background:#5BA880; border-radius:2px; transition:width 0.3s;"></div>
              </div>
            </div>
            <% badge_colors = case route.status
                              when 'active' then 'background:rgba(91,168,128,0.1); color:#3D7A5A'
                              when 'completed' then 'background:rgba(110,155,200,0.1); color:#4A7A9E'
                              when 'paused' then 'background:rgba(176,152,72,0.1); color:#8B6D28'
                              else 'background:rgba(28,24,18,0.05); color:#6D665B'
                              end %>
            <span style="font-family:'DM Mono',monospace; font-size:0.6rem; letter-spacing:0.5px; text-transform:uppercase; padding:0.25rem 0.55rem; border-radius:6px; <%= badge_colors %>">
              <%= t("dashboard.status.#{route.status}") %>
            </span>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

<% else %>
  <%# === Empty state: no routes yet === %>
  <div style="background:rgba(255,255,255,0.5); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border:1px solid rgba(28,24,18,0.06); border-radius:20px; padding:3rem 2rem; text-align:center;">

    <%# Decorative route icon %>
    <div style="width:56px; height:56px; border-radius:14px; background:linear-gradient(135deg, rgba(139,128,196,0.12), rgba(91,168,128,0.12)); display:inline-flex; align-items:center; justify-content:center; margin-bottom:1.2rem;">
      <%= render "shared/logo", size: 28 %>
    </div>

    <h2 style="font-family:'DM Sans',sans-serif; font-weight:700; font-size:1.15rem; color:#1C1812; margin:0 0 0.5rem; letter-spacing:-0.3px;">
      <%= t("dashboard.empty_heading") %>
    </h2>
    <p style="font-family:'DM Sans',sans-serif; font-size:0.82rem; color:#A09889; margin:0; max-width:340px; margin-left:auto; margin-right:auto; line-height:1.5;">
      <%= t("dashboard.empty_body") %>
    </p>
  </div>
<% end %>

<%# === Profile summary === %>
<% if @profile %>
  <div style="margin-top:1.5rem; background:rgba(255,255,255,0.45); border:1px solid rgba(28,24,18,0.06); border-radius:14px; padding:1.2rem 1.3rem;">
    <p style="font-family:'DM Mono',monospace; font-size:0.6rem; letter-spacing:1.5px; text-transform:uppercase; color:#A09889; margin:0 0 0.8rem;">
      <%= t("dashboard.profile_heading") %>
    </p>
    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:0.8rem;">
      <div>
        <p style="font-family:'DM Sans',sans-serif; font-size:0.7rem; color:#A09889; margin:0 0 0.2rem;"><%= t("dashboard.profile_interests") %></p>
        <p style="font-family:'DM Sans',sans-serif; font-size:0.82rem; font-weight:500; color:#1C1812; margin:0;"><%= @profile.interests&.presence&.map(&:capitalize)&.join(", ") || "—" %></p>
      </div>
      <div>
        <p style="font-family:'DM Sans',sans-serif; font-size:0.7rem; color:#A09889; margin:0 0 0.2rem;"><%= t("dashboard.profile_level") %></p>
        <p style="font-family:'DM Sans',sans-serif; font-size:0.82rem; font-weight:500; color:#1C1812; margin:0;"><%= @profile.current_level ? t("settings.learning.level_#{@profile.current_level}", default: @profile.current_level.capitalize) : "—" %></p>
      </div>
      <div>
        <p style="font-family:'DM Sans',sans-serif; font-size:0.7rem; color:#A09889; margin:0 0 0.2rem;"><%= t("dashboard.profile_style") %></p>
        <p style="font-family:'DM Sans',sans-serif; font-size:0.82rem; font-weight:500; color:#1C1812; margin:0;"><%= @profile.learning_style&.presence&.map(&:capitalize)&.join(", ") || "—" %></p>
      </div>
      <div>
        <p style="font-family:'DM Sans',sans-serif; font-size:0.7rem; color:#A09889; margin:0 0 0.2rem;"><%= t("dashboard.profile_timeline") %></p>
        <p style="font-family:'DM Sans',sans-serif; font-size:0.82rem; font-weight:500; color:#1C1812; margin:0;"><%= @profile.timeline&.humanize || "—" %></p>
      </div>
    </div>
  </div>
<% end %>
