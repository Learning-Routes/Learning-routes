<turbo-frame id="profile-achievements">
<%
  all_achievements = [
    { emoji: "\u{1F31F}", title: t("achievements.first_route"),     desc: t("achievements.first_route_desc"),  unlocked: @completed_routes.any?,        color: "#8B80C4" },
    { emoji: "\u{1F525}", title: t("achievements.streak_3"),        desc: t("achievements.streak_3_desc"),     unlocked: @streak >= 3,                  color: "#B09848" },
    { emoji: "\u{1F525}", title: t("achievements.streak_14"),       desc: t("achievements.streak_14_desc"),    unlocked: @streak >= 14,                 color: "#B09848" },
    { emoji: "\u{1F3AF}", title: t("achievements.sharpshooter"),    desc: t("achievements.sharpshooter_desc"), unlocked: @total_steps_completed >= 50 && @avg_accuracy >= 90, color: "#5BA880" },
    { emoji: "\u{26A1}",  title: t("achievements.fast_learner"),    desc: t("achievements.fast_learner_desc"), unlocked: @total_steps_completed >= 5,   color: "#6E9BC8" },
    { emoji: "\u{2705}",  title: t("achievements.first_step"),      desc: t("achievements.first_step_desc"),   unlocked: @total_steps_completed > 0,    color: "#5BA880" },
    { emoji: "\u{2705}",  title: t("achievements.ten_steps"),       desc: t("achievements.ten_steps_desc"),    unlocked: @total_steps_completed >= 10,  color: "#5BA880" },
    { emoji: "\u{1F4DA}", title: t("achievements.half_century"),    desc: t("achievements.half_century_desc"), unlocked: @total_steps_completed >= 50,  color: "#5BA880" },
    { emoji: "\u{2B50}",  title: t("achievements.accuracy_80"),     desc: t("achievements.accuracy_80_desc"),  unlocked: @avg_accuracy >= 80,           color: "#B09848" },
    { emoji: "\u{2B50}",  title: t("achievements.accuracy_95"),     desc: t("achievements.accuracy_95_desc"),  unlocked: @avg_accuracy >= 95,           color: "#B09848" },
    { emoji: "\u{23F0}",  title: t("achievements.ten_hours"),       desc: t("achievements.ten_hours_desc"),    unlocked: @study_minutes >= 600,         color: "#6E9BC8" },
    { emoji: "\u{1F3D4}",  title: t("achievements.climber"),        desc: t("achievements.climber_desc"),      unlocked: false,                         color: "#8B80C4" },
    { emoji: "\u{1F310}", title: t("achievements.polymath"),        desc: t("achievements.polymath_desc"),     unlocked: @routes.map(&:subject_area).compact.uniq.size >= 3, color: "#7EA5A0" },
    { emoji: "\u{1F680}", title: t("achievements.route_complete"),  desc: t("achievements.route_complete_desc"), unlocked: @completed_routes.any?,      color: "#6E9BC8" },
  ]

  # Sort: unlocked first, then locked
  sorted = all_achievements.sort_by { |a| a[:unlocked] ? 0 : 1 }
%>

<div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:12px;">
  <% sorted.each do |ach| %>
    <div style="background:<%= ach[:unlocked] ? '#FEFDFB' : 'transparent' %>; border:1px solid rgba(28,24,18,<%= ach[:unlocked] ? '0.04' : '0.05' %>); border-radius:14px; padding:16px; display:flex; align-items:center; gap:12px; opacity:<%= ach[:unlocked] ? '1' : '0.4' %>;">

      <%# Icon %>
      <div role="img" aria-label="<%= ach[:title] %><%= " (#{t('achievements.unlocked_label')})" if ach[:unlocked] %>" style="width:42px; height:42px; border-radius:12px; background:<%= ach[:color] %><%= ach[:unlocked] ? '1A' : '06' %>; display:flex; align-items:center; justify-content:center; flex-shrink:0; font-size:1.2rem;<%= ' filter:grayscale(1);' unless ach[:unlocked] %>">
        <%= ach[:emoji] %>
      </div>

      <%# Text %>
      <div style="flex:1; min-width:0;">
        <p style="font-family:'DM Sans',sans-serif; font-size:0.8rem; font-weight:600; color:#1C1812; margin:0 0 0.15rem;">
          <%= ach[:title] %>
          <% if ach[:unlocked] %>
            <svg aria-hidden="true" width="12" height="12" viewBox="0 0 16 16" fill="none" style="vertical-align:-1px; margin-left:3px;"><path d="M3 8l3.5 3.5L13 5" stroke="#5BA880" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <% end %>
        </p>
        <p style="font-family:'DM Sans',sans-serif; font-size:0.68rem; color:#A09889; margin:0;">
          <%= ach[:desc] %>
        </p>
      </div>
    </div>
  <% end %>
</div>

</turbo-frame>
