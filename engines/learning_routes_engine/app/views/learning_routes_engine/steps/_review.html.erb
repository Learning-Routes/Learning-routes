<div id="<%= dom_id(@step, :review) %>" class="space-y-6">
  <div>
    <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-purple-900/50 text-purple-300 mb-2">
      <%= t('learning_engine.review.badge') %>
    </span>
    <h1 class="text-2xl font-bold text-white"><%= @step.title %></h1>
    <p class="text-sm text-gray-400 mt-1"><%= @step.description %></p>
  </div>

  <!-- Memory strength indicator -->
  <% if @retrievability %>
    <div class="bg-gray-900 border border-white/[0.06] rounded-xl p-5">
      <h3 class="text-sm font-semibold text-gray-300 mb-3"><%= t('learning_engine.review.memory_strength') %></h3>
      <div class="flex items-center gap-4">
        <div class="flex-1">
          <div class="h-3 bg-gray-800 rounded-full overflow-hidden">
            <div class="h-full rounded-full transition-all duration-500
                        <%= @retrievability >= 0.7 ? 'bg-green-500' : @retrievability >= 0.4 ? 'bg-yellow-500' : 'bg-red-500' %>"
                 style="width: <%= (@retrievability * 100).round %>%"></div>
          </div>
        </div>
        <span class="text-sm font-semibold <%= @retrievability >= 0.7 ? 'text-green-400' : @retrievability >= 0.4 ? 'text-yellow-400' : 'text-red-400' %>">
          <%= (@retrievability * 100).round %>%
        </span>
      </div>
    </div>
  <% end %>

  <!-- Concept map placeholder -->
  <div class="bg-gray-900 border border-white/[0.06] rounded-xl p-5" data-controller="mind-map">
    <h3 class="text-sm font-semibold text-gray-300 mb-3"><%= t('learning_engine.review.concept_map') %></h3>
    <div data-mind-map-target="svg" class="w-full h-64 flex items-center justify-center">
      <% if @review_steps.any? %>
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 w-full">
          <% @review_steps.each do |step| %>
            <div class="bg-gray-800/50 border border-white/[0.04] rounded-lg p-3 text-center">
              <div class="text-xs font-medium text-gray-300 truncate"><%= step.title %></div>
              <div class="text-xs text-gray-500 mt-1"><%= t("learning_engine.#{step.content_type}.badge") %></div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-sm text-gray-500"><%= t('learning_engine.review.no_steps') %></p>
      <% end %>
    </div>
  </div>

  <!-- FSRS Rating buttons -->
  <% unless @step.completed? %>
    <div class="bg-gray-900 border border-white/[0.06] rounded-xl p-5">
      <h3 class="text-sm font-semibold text-gray-300 mb-4"><%= t('learning_engine.review.prompt') %></h3>
      <div class="grid grid-cols-4 gap-3">
        <% [
          [1, t('learning_engine.review.again'), "text-red-400", "bg-red-900/30 border-red-700/30 hover:bg-red-900/50"],
          [2, t('learning_engine.review.hard'), "text-orange-400", "bg-orange-900/30 border-orange-700/30 hover:bg-orange-900/50"],
          [3, t('learning_engine.review.good'), "text-green-400", "bg-green-900/30 border-green-700/30 hover:bg-green-900/50"],
          [4, t('learning_engine.review.easy'), "text-blue-400", "bg-blue-900/30 border-blue-700/30 hover:bg-blue-900/50"]
        ].each do |rating, label, text_class, bg_class| %>
          <%= button_to label,
              learning_routes_engine.submit_review_review_path(@step),
              params: { rating: rating },
              method: :post,
              class: "rounded-lg px-3 py-3 text-sm font-semibold #{text_class} #{bg_class} border transition" %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
