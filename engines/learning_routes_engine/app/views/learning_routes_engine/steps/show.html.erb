<% content_for(:title, "#{@step.localized_title} #{t('learning_engine.route.title_suffix')}") %>

<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
  <div class="flex gap-8">
    <!-- Main content area -->
    <div class="flex-1 max-w-3xl">
      <turbo-frame id="step_content_<%= @step.id %>">
        <% if @step.delivery_format == "audio" %>
          <%# Audio-based lesson: player + voice response + quiz %>
          <%= render "content_engine/audio/audio_lesson", step: @step, content: @step.audio_content %>
        <% else %>
          <% case @step.content_type %>
          <% when "lesson" %>
            <%= render "lesson" %>
          <% when "exercise" %>
            <%= render "exercise" %>
          <% when "assessment" %>
            <%= render "assessment" %>
          <% when "review" %>
            <%= render "review" %>
          <% end %>
        <% end %>
      </turbo-frame>


<!-- Step social actions -->
<div class="flex items-center gap-3 mt-6 mb-4">
  <%= render "community_engine/likes/button", likeable: @step, liked: @step.liked_by?(current_user), likes_count: @step.likes.count %>
</div>

      <!-- Navigation -->
      <%= render "navigation" %>
    </div>


<!-- Comments section -->
<div class="mt-10 pt-8 border-t border-white/[0.06]">
  <div class="[&_h3]:text-gray-200 [&_p]:text-gray-300 [&_span]:text-gray-400 [&_textarea]:bg-gray-900 [&_textarea]:border-gray-700 [&_textarea]:text-gray-200 [&_textarea]:placeholder-gray-500 [&_button[type=submit]]:bg-gray-700 [&_button[type=submit]]:text-gray-200">
    <%= render "community_engine/comments/section", commentable: @step %>
  </div>
</div>

    <!-- Sidebar -->
    <%= render "sidebar" %>
  </div>
</div>
