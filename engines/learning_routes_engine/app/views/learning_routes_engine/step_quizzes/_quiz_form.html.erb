<div id="step_quiz_form" data-controller="step-quiz" data-step-quiz-total-value="<%= questions.size %>">
  <div class="bg-gray-900 border border-white/[0.06] rounded-xl p-6">
    <%# Header %>
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <div class="inline-flex items-center justify-center w-10 h-10 rounded-xl bg-amber-500/10 border border-amber-500/20">
          <svg aria-hidden="true" class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div>
          <h3 class="text-sm font-semibold text-white"><%= t("learning_engine.step_quiz.title") %></h3>
          <p class="text-xs text-gray-400"><%= t("learning_engine.step_quiz.subtitle", count: questions.size) %></p>
        </div>
      </div>
      <span class="text-xs text-gray-500 font-mono" data-step-quiz-target="counter">
        0/<%= questions.size %>
      </span>
    </div>

    <%# Questions %>
    <%= form_with url: learning_routes_engine.submit_route_step_step_quiz_path(route, step),
                  method: :post, data: { step_quiz_target: "form" } do |f| %>
      <div class="space-y-5">
        <% questions.each_with_index do |question, idx| %>
          <div class="rounded-lg bg-gray-800/50 border border-white/[0.04] p-4">
            <p class="text-sm font-medium text-white mb-3">
              <span class="text-gray-500 font-mono text-xs mr-2"><%= idx + 1 %>.</span>
              <%= question.body %>
            </p>
            <div class="space-y-2">
              <% Array(question.options).each do |option| %>
                <label class="flex items-center gap-3 p-2.5 rounded-lg hover:bg-gray-700/50 cursor-pointer transition group">
                  <input type="radio"
                         name="answers[<%= question.id %>]"
                         value="<%= option %>"
                         class="w-4 h-4 text-indigo-500 bg-gray-700 border-gray-600 focus:ring-indigo-500 focus:ring-offset-0"
                         data-action="change->step-quiz#markAnswered">
                  <span class="text-sm text-gray-300 group-hover:text-white transition"><%= option %></span>
                </label>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="mt-6 flex items-center justify-between">
        <p class="text-xs text-gray-500"><%= t("learning_engine.step_quiz.passing_note") %></p>
        <button type="submit"
                class="rounded-lg px-5 py-2 text-sm font-semibold text-white bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-400 hover:to-purple-400 transition disabled:opacity-40 disabled:cursor-not-allowed"
                data-step-quiz-target="submitBtn"
                disabled>
          <%= t("learning_engine.step_quiz.submit") %>
        </button>
      </div>
    <% end %>
  </div>
</div>
