<%# Single post card. Locals: post %>
<div id="post_<%= post.id %>" style="background:var(--color-card, rgba(255,255,255,0.6)); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
            border:1px solid var(--color-faint, rgba(28,24,18,0.06)); border-radius:14px; padding:1.25rem 1.5rem; transition:box-shadow 0.15s;">
  <div style="display:flex; align-items:flex-start; gap:1rem;">
    <%# Avatar %>
    <div style="width:42px; height:42px; border-radius:50%; background:var(--color-accent, #2C261E);
                display:flex; align-items:center; justify-content:center; color:var(--color-accent-text, #F5F1EB);
                font-family:'DM Sans',sans-serif; font-size:0.8rem; font-weight:700; flex-shrink:0;">
      <%= post.user.name.to_s.first&.upcase || "?" %>
    </div>

    <div style="flex:1; min-width:0;">
      <%# Author + time %>
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.35rem;">
        <span style="font-family:'DM Sans',sans-serif; font-size:0.92rem; font-weight:600; color:var(--color-txt, #1C1812);">
          <%= post.user.name %>
        </span>
        <span style="font-family:'DM Mono',monospace; font-size:0.7rem; color:var(--color-muted, #887F72);">
          <%= time_ago_in_words(post.created_at) %>
        </span>
        <% if post.owned_by?(current_user) %>
          <%= button_to community_engine.post_path(post), method: :delete,
                data: { turbo_confirm: t("community_engine.posts.delete_confirm") },
                style: "background:none; border:none; cursor:pointer; font-family:'DM Sans',sans-serif; font-size:0.7rem; color:var(--color-muted, #887F72); padding:0; margin-left:auto;" do %>
            <%= t("community_engine.posts.delete") %>
          <% end %>
        <% end %>
      </div>

      <%# Post body %>
      <p style="font-family:'DM Sans',sans-serif; font-size:0.95rem; color:var(--color-sub, #6D665B); line-height:1.65; margin:0; white-space:pre-wrap; word-break:break-word;">
        <%= post.body %>
      </p>

      <%# Inline floating thought â€” side-popping circle with featured comment %>
      <% best_comment = post.comments.order(created_at: :desc).includes(:user).first %>
      <% if best_comment %>
        <div data-controller="floating-thoughts"
             data-floating-thoughts-interval-value="8000"
             style="position:relative; margin-top:0.5rem; height:36px;">
          <div data-floating-thoughts-target="thought"
               style="position:absolute; left:0; top:0; opacity:0; transform:translateX(-8px);
                      display:inline-flex; align-items:center; gap:0.5rem; max-width:100%;
                      transition:opacity 0.5s ease, transform 0.5s ease;">
            <div style="flex-shrink:0; width:28px; height:28px; border-radius:50%;
                        background:var(--color-accent, #2C261E); color:var(--color-accent-text, #F5F1EB);
                        display:flex; align-items:center; justify-content:center;
                        font-family:'DM Sans',sans-serif; font-size:0.55rem; font-weight:700;
                        box-shadow:0 2px 8px rgba(0,0,0,0.1);">
              <%= best_comment.user&.name.to_s.first&.upcase || "?" %>
            </div>
            <div style="position:relative; background:var(--color-tint, rgba(28,24,18,0.05)); border-radius:10px;
                        padding:0.3rem 0.55rem; max-width:250px; border:1px solid var(--color-faint, rgba(28,24,18,0.06));">
              <div style="position:absolute; left:-5px; top:50%; transform:translateY(-50%);
                          width:0; height:0; border-top:5px solid transparent; border-bottom:5px solid transparent;
                          border-right:5px solid var(--color-tint, rgba(28,24,18,0.05));"></div>
              <p style="font-family:'DM Sans',sans-serif; font-size:0.7rem; color:var(--color-sub, #6D665B);
                       line-height:1.3; margin:0; font-style:italic;
                       overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                "<%= best_comment.body.truncate(50) %>"
              </p>
            </div>
          </div>
        </div>
      <% end %>

      <%# Actions row %>
      <div style="display:flex; align-items:center; gap:1.25rem; margin-top:0.6rem;">
        <%= render "community_engine/likes/button",
              likeable: post,
              liked: post.liked_by?(current_user),
              likes_count: post.likes_count %>
        <span style="display:inline-flex; align-items:center; gap:0.3rem; font-family:'DM Mono',monospace; font-size:0.7rem; color:var(--color-muted, #887F72);">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
          <%= post.comments_count %>
        </span>
      </div>
    </div>
  </div>
</div>
