<div>
  <% if trending_routes.any? %>
    <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(260px, 1fr)); gap:0.75rem;">
      <% trending_routes.each do |shared_route| %>
        <% route = shared_route.learning_route %>
        <div class="feed-card" style="background:var(--color-card, rgba(255,255,255,0.6)); backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px);
                    border:1px solid var(--color-faint, rgba(28,24,18,0.06)); border-radius:12px; padding:1rem 1.15rem; transition:box-shadow 0.15s;">
          <%# Route topic + author on same row %>
          <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem;">
            <div style="width:24px; height:24px; border-radius:50%; background:var(--color-accent, #2C261E);
                        display:flex; align-items:center; justify-content:center; color:var(--color-accent-text, #F5F1EB);
                        font-family:'DM Sans',sans-serif; font-size:0.5rem; font-weight:700; flex-shrink:0;">
              <%= shared_route.user.name.to_s.first&.upcase || "?" %>
            </div>
            <div style="flex:1; min-width:0;">
              <h3 style="font-family:'DM Sans',sans-serif; font-weight:600; font-size:0.85rem; color:var(--color-txt, #1C1812); margin:0;
                         overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                <%= route.localized_topic %>
              </h3>
              <p style="font-family:'DM Mono',monospace; font-size:0.6rem; color:var(--color-muted, #887F72); margin:0;">
                <%= shared_route.user.name %> Â· <%= route.localized_subject_area %>
              </p>
            </div>
          </div>

          <%# Description preview %>
          <% if shared_route.description.present? %>
            <p style="font-family:'DM Sans',sans-serif; font-size:0.72rem; color:var(--color-sub, #6D665B); line-height:1.45; margin:0 0 0.5rem;
                      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;">
              <%= shared_route.description %>
            </p>
          <% end %>

          <%# Star rating %>
          <div style="margin-bottom:0.4rem;">
            <%= render "community_engine/ratings/stars", shared_route: shared_route, interactive: false %>
          </div>

          <%# Stats + actions row %>
          <div style="display:flex; align-items:center; gap:0.75rem; font-family:'DM Mono',monospace; font-size:0.6rem; color:var(--color-muted, #887F72);">
            <span style="display:inline-flex; align-items:center; gap:0.2rem;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>
              <%= shared_route.likes_count %>
            </span>
            <span style="display:inline-flex; align-items:center; gap:0.2rem;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
              <%= shared_route.comments_count %>
            </span>
            <span style="display:inline-flex; align-items:center; gap:0.2rem;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
              <%= shared_route.clones_count %>
            </span>

            <div style="margin-left:auto; display:flex; gap:0.35rem;">
              <%= link_to community_engine.shared_route_path(shared_route.share_token),
                    style: "padding:0.35rem 0.7rem; border-radius:8px; background:var(--color-accent, #2C261E);
                           color:var(--color-accent-text, #F5F1EB); font-family:'DM Sans',sans-serif; font-size:0.68rem; font-weight:500;
                           text-decoration:none; transition:opacity 0.15s;" do %>
                <%= t("community_engine.feed.trending.view_route") %>
              <% end %>

              <% if defined?(current_user) && current_user && shared_route.user_id != current_user.id %>
                <%= button_to community_engine.clone_shared_route_path(shared_route),
                      method: :post,
                      style: "padding:0.35rem 0.7rem; border-radius:8px;
                             border:1px solid var(--color-faint, #CCC5B8); background:transparent; color:var(--color-txt, #1C1812);
                             font-family:'DM Sans',sans-serif; font-size:0.68rem; font-weight:500; cursor:pointer; transition:all 0.15s;" do %>
                  <%= t("community_engine.feed.trending.clone_route") %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div style="background:var(--color-card, rgba(255,255,255,0.6)); backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px);
                border:1px solid var(--color-faint, rgba(28,24,18,0.06)); border-radius:12px; padding:2.5rem 1.5rem; text-align:center;">
      <div style="width:40px; height:40px; margin:0 auto 0.75rem; border-radius:10px; background:var(--color-faint, rgba(28,24,18,0.04));
                  display:flex; align-items:center; justify-content:center;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-muted, #887F72)" stroke-width="1.5">
          <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <p style="font-family:'DM Sans',sans-serif; font-size:0.82rem; font-weight:600; color:var(--color-txt, #1C1812); margin:0 0 0.2rem;">
        <%= t("community_engine.feed.trending.empty_title") %>
      </p>
      <p style="font-family:'DM Sans',sans-serif; font-size:0.72rem; color:var(--color-muted, #887F72); margin:0; max-width:300px; margin-left:auto; margin-right:auto; line-height:1.45;">
        <%= t("community_engine.feed.trending.empty_subtitle") %>
      </p>
    </div>
  <% end %>
</div>
