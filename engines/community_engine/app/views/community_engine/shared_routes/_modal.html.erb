<div data-controller="share"
     data-share-url-value="<%= community_engine.shared_routes_path %>"
     data-share-route-id-value="<%= route.id %>"
     class="fixed inset-0 z-50 flex items-center justify-center p-4"
     data-action="keydown.esc->share#close">

  <%# Backdrop %>
  <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" data-action="click->share#close"></div>

  <%# Modal %>
  <div class="relative bg-white rounded-[20px] shadow-2xl w-full max-w-md overflow-hidden" data-share-target="modal">
    <%# Header %>
    <div class="flex items-center justify-between px-6 py-4 border-b border-[#E8E4DC]">
      <h3 class="text-lg font-bold text-[#1C1812]" style="font-family: 'DM Sans', sans-serif;">
        <%= t("community_engine.share_modal.title") %>
      </h3>
      <button data-action="click->share#close" class="text-[#9B9590] hover:text-[#1C1812] transition-colors">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <%# Form view (before sharing) %>
    <div data-share-target="formView" class="px-6 py-5 space-y-5">
      <%# Visibility selector %>
      <div>
        <label class="block text-sm font-medium text-[#1C1812] mb-2" style="font-family: 'DM Sans', sans-serif;">
          <%= t("community_engine.share_modal.visibility_label") %>
        </label>
        <div class="grid grid-cols-3 gap-2">
          <% [
            ["public", t("community_engine.share_modal.visibility.public"), t("community_engine.share_modal.visibility.public_desc")],
            ["unlisted", t("community_engine.share_modal.visibility.unlisted"), t("community_engine.share_modal.visibility.unlisted_desc")],
            ["private", t("community_engine.share_modal.visibility.private"), t("community_engine.share_modal.visibility.private_desc")]
          ].each do |value, label, desc| %>
            <button type="button"
                    data-action="click->share#selectVisibility"
                    data-visibility="<%= value %>"
                    data-share-target="visibilityBtn"
                    class="visibility-option p-3 rounded-[11px] border text-center transition-all duration-150 <%= value == 'public' ? 'border-[#2C261E] bg-[#2C261E]/5' : 'border-[#E0DBCF] hover:border-[#CCC5B8]' %>"
                    title="<%= desc %>">
              <span class="block text-sm font-medium text-[#1C1812]" style="font-family: 'DM Sans', sans-serif;"><%= label %></span>
              <span class="block text-[10px] text-[#9B9590] mt-0.5" style="font-family: 'DM Mono', monospace;"><%= desc %></span>
            </button>
          <% end %>
        </div>
      </div>

      <%# Description %>
      <div>
        <label class="block text-sm font-medium text-[#1C1812] mb-2" style="font-family: 'DM Sans', sans-serif;">
          <%= t("community_engine.share_modal.description_label") %>
        </label>
        <textarea data-share-target="description"
                  placeholder="<%= t('community_engine.share_modal.description_placeholder') %>"
                  rows="3"
                  class="w-full px-4 py-3 rounded-[14px] bg-[#F5F1EB] border border-[#E0DBCF] text-sm text-[#1C1812] placeholder-[#9B9590] focus:outline-none focus:ring-2 focus:ring-[#2C261E]/20 focus:border-[#2C261E] resize-none"
                  style="font-family: 'DM Sans', sans-serif;"></textarea>
      </div>

      <%# Share button %>
      <button data-action="click->share#submit"
              data-share-target="submitBtn"
              class="w-full py-3 rounded-[11px] bg-[#2C261E] text-[#F5F1EB] text-sm font-medium hover:bg-[#3D3730] transition-colors"
              style="font-family: 'DM Sans', sans-serif;">
        <%= t("community_engine.share_modal.share_btn") %>
      </button>
    </div>

    <%# Success view (after sharing) %>
    <div data-share-target="successView" class="hidden px-6 py-5 space-y-4">
      <div class="text-center mb-2">
        <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-green-100 flex items-center justify-center">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2">
            <path d="M20 6L9 17l-5-5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <p class="text-sm font-medium text-[#1C1812]" style="font-family: 'DM Sans', sans-serif;">
          <%= t("community_engine.share_modal.success") %>
        </p>
      </div>

      <%# Share URL with copy %>
      <div class="flex items-center gap-2">
        <input type="text"
               data-share-target="urlField"
               readonly
               class="flex-1 px-4 py-2.5 rounded-[11px] bg-[#F5F1EB] border border-[#E0DBCF] text-sm text-[#1C1812] select-all"
               style="font-family: 'DM Mono', monospace;">
        <button data-action="click->share#copyUrl"
                data-share-target="copyBtn"
                class="flex-shrink-0 px-4 py-2.5 rounded-[11px] bg-[#2C261E] text-[#F5F1EB] text-sm font-medium hover:bg-[#3D3730] transition-colors"
                style="font-family: 'DM Sans', sans-serif;">
          <%= t("community_engine.share_modal.copy") %>
        </button>
      </div>

      <button data-action="click->share#close"
              class="w-full py-2.5 rounded-[11px] border border-[#CCC5B8] text-[#1C1812] text-sm font-medium hover:bg-[#E8E4DC] transition-colors"
              style="font-family: 'DM Sans', sans-serif;">
        <%= t("community_engine.share_modal.done") %>
      </button>
    </div>
  </div>
</div>
