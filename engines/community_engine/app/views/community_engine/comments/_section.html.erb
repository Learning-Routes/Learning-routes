<div style="margin-top:2rem;" data-controller="comment-reply comment-edit"
     data-comment-edit-cancel-text-value="<%= t('community_engine.comments.cancel') %>"
     data-comment-edit-save-text-value="<%= t('community_engine.comments.save') %>">
  <%# Header %>
  <h3 style="font-family:'DM Sans',sans-serif; font-weight:700; font-size:1.1rem; color:var(--color-txt, #1C1812); margin:0 0 1rem;">
    <%= t("community_engine.comments.heading", count: commentable.comments.count) %>
  </h3>

  <%# Top-level comment form %>
  <div style="margin-bottom:1.5rem;">
    <%= render "community_engine/comments/form", commentable: commentable %>
  </div>

  <%# Comments list with real-time updates %>
  <%= turbo_stream_from "comments_#{commentable.class.name.parameterize}_#{commentable.id}" %>

  <div id="comments_<%= commentable.class.name.parameterize %>_<%= commentable.id %>"
       style="border-top:1px solid var(--color-faint, rgba(28,24,18,0.06));">
    <% commentable.comments.top_level.includes(:user, replies: :user).recent.each do |comment| %>
      <div style="border-bottom:1px solid var(--color-faint, rgba(28,24,18,0.06));">
        <%= render "community_engine/comments/comment", comment: comment %>
      </div>
    <% end %>

    <% if commentable.comments.none? %>
      <p style="padding:2rem 0; text-align:center; font-family:'DM Sans',sans-serif; font-size:0.82rem; color:var(--color-muted, #887F72);">
        <%= t("community_engine.comments.empty") %>
      </p>
    <% end %>
  </div>
</div>
