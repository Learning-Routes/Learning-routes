<div id="comment_<%= comment.id %>" class="flex gap-3 py-4 <%= comment.parent_id? ? 'ml-10 border-l-2 border-[#E8E4DC] pl-4' : '' %>">
  <%# Avatar %>
  <div class="flex-shrink-0 w-8 h-8 rounded-full bg-[#2C261E] flex items-center justify-center text-[#F5F1EB] text-xs font-bold"
       style="font-family: 'DM Sans', sans-serif;">
    <%= comment.user.name.first.upcase %>
  </div>

  <div class="flex-1 min-w-0">
    <%# Header: name + time + edited badge %>
    <div class="flex items-center gap-2 mb-1">
      <span class="text-sm font-semibold text-[#1C1812]" style="font-family: 'DM Sans', sans-serif;">
        <%= comment.user.name %>
      </span>
      <span class="text-xs text-[#9B9590]" style="font-family: 'DM Mono', monospace;">
        <%= time_ago_in_words(comment.created_at) %>
      </span>
      <% if comment.edited? %>
        <span class="text-[10px] text-[#9B9590] bg-[#E8E4DC] px-1.5 py-0.5 rounded-md" style="font-family: 'DM Mono', monospace;"><%= t("community_engine.comments.edited") %></span>
      <% end %>
    </div>

    <%# Body %>
    <p class="text-sm text-[#3D3730] leading-relaxed mb-2" style="font-family: 'DM Sans', sans-serif;">
      <%= simple_format(comment.body, {}, wrapper_tag: "span") %>
    </p>

    <%# Actions %>
    <div class="flex items-center gap-3">
      <%= render "community_engine/likes/button", likeable: comment, liked: (defined?(current_user) && current_user ? comment.liked_by?(current_user) : false), likes_count: comment.likes_count %>

      <% if comment.top_level? %>
        <button class="text-xs text-[#6B6560] hover:text-[#1C1812] transition-colors"
                style="font-family: 'DM Sans', sans-serif;"
                data-action="click->comment-reply#show"
                data-comment-id="<%= comment.id %>">
          <%= t("community_engine.comments.reply") %>
        </button>
      <% end %>

      <% if defined?(current_user) && current_user && comment.owned_by?(current_user) %>
        <button class="text-xs text-[#6B6560] hover:text-[#1C1812] transition-colors"
                style="font-family: 'DM Sans', sans-serif;"
                data-action="click->comment-edit#show"
                data-comment-id="<%= comment.id %>">
          <%= t("community_engine.comments.edit") %>
        </button>
        <%= button_to community_engine.comment_path(comment), method: :delete,
              class: "text-xs text-[#6B6560] hover:text-red-500 transition-colors",
              style: "font-family: 'DM Sans', sans-serif;",
              data: { turbo_confirm: t("community_engine.comments.delete_confirm") } do %>
          <%= t("community_engine.comments.delete") %>
        <% end %>
      <% end %>
    </div>

    <%# Reply form placeholder %>
    <div id="reply_form_<%= comment.id %>" class="hidden mt-3">
      <%= render "community_engine/comments/form", commentable: comment.commentable, parent_id: comment.id %>
    </div>

    <%# Nested replies (max 2 levels) %>
    <% if comment.top_level? && comment.replies.any? %>
      <div class="mt-3 space-y-0">
        <% comment.replies.order(created_at: :asc).each do |reply| %>
          <%= render "community_engine/comments/comment", comment: reply %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
