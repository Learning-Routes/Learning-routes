<% content_for(:title, "Assessment - #{@step.title}") %>

<div class="mx-auto max-w-2xl px-4 sm:px-6 lg:px-8 py-12">
  <div class="bg-gray-900 border border-white/[0.06] rounded-2xl p-8 text-center">

    <%# Assessment icon %>
    <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-indigo-500/10 border border-indigo-500/20 mb-6">
      <svg aria-hidden="true" class="w-8 h-8 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
    </div>

    <h1 class="text-xl font-bold text-white mb-2"><%= @step.title %></h1>

    <p class="text-sm text-gray-400 mb-8">
      Test your understanding of this topic.
    </p>

    <%# Stats grid %>
    <div class="grid grid-cols-3 gap-4 mb-8">
      <div class="bg-gray-800/50 rounded-xl p-3">
        <div class="text-lg font-bold text-white"><%= @questions_count %></div>
        <div class="text-xs text-gray-500">Questions</div>
      </div>
      <div class="bg-gray-800/50 rounded-xl p-3">
        <div class="text-lg font-bold text-white"><%= @assessment.passing_score %>%</div>
        <div class="text-xs text-gray-500">To pass</div>
      </div>
      <div class="bg-gray-800/50 rounded-xl p-3">
        <div class="text-lg font-bold text-white"><%= @assessment.time_limit_minutes || "∞" %></div>
        <div class="text-xs text-gray-500">Minutes</div>
      </div>
    </div>

    <% if @existing_result&.score %>
      <%# Previous attempt %>
      <div class="bg-gray-800/50 rounded-xl p-4 mb-6 text-left">
        <p class="text-xs text-gray-500 uppercase tracking-wider mb-2">Last attempt</p>
        <div class="flex items-center justify-between">
          <span class="text-sm font-medium <%= @existing_result.passed? ? 'text-green-400' : 'text-red-400' %>">
            <%= @existing_result.score.round(1) %>% — <%= @existing_result.passed? ? 'Passed' : 'Not passed' %>
          </span>
          <span class="text-xs text-gray-500"><%= @existing_result.created_at.strftime("%d %b %Y") %></span>
        </div>
      </div>
    <% end %>

    <%# Actions %>
    <div class="flex items-center justify-center gap-4">
      <%= link_to learning_routes_engine.route_path(@route),
          class: "rounded-lg px-4 py-2.5 text-sm font-medium text-gray-300 bg-gray-800 hover:bg-gray-700 border border-white/[0.06] transition" do %>
        Back to route
      <% end %>

      <%= button_to "Start exam",
          assessments.start_assessment_path(@assessment),
          method: :post,
          class: "rounded-lg px-6 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-400 hover:to-purple-400 transition cursor-pointer" %>
    </div>
  </div>
</div>
